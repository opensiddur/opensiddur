<?xml version="1.0" encoding="utf-8"?>
<TEI 
  xmlns="http://www.tei-c.org/ns/1.0" 
  xmlns:sch="http://purl.oclc.org/dsdl/schematron"
  xml:lang="en">
  <teiHeader>
    <fileDesc>
      <titleStmt>
        <title>Open Siddur Jewish Liturgy TEI extension</title>
        <editor xml:id="EDF">Efraim Feinstein</editor>
        <editor xml:id="sbauman.emt">Syd Bauman</editor>
        <editor xml:id="LB">Lou Burnard</editor>
        <editor xml:id="SR">Sebastian Rahtz</editor>
      </titleStmt>
      <publicationStmt>
        <availability status="restricted">
          <licence target="http://www.creativecommons.org/licenses/by-sa/3.0"/>
        </availability>
      </publicationStmt>
      <notesStmt>
        <note type="ns">http://jewishliturgy.org/ns/jlptei/1.0</note>
      </notesStmt>
      <sourceDesc>
        <p>Initially created on <date when="2006-10-12T05:24:41">Thursday 12th
            October 2006</date> by the form at
        http://www.tei-c.org.uk/Roma/.</p>
      </sourceDesc>
    </fileDesc>
    <revisionDesc>
      <change when="2012-05-06" who="#EDF">Change bare TEI ODD to JLPTEI</change>
      <change when="2011-03-26" who="#SR">rewrite as new-style ODD </change>
      <change when="2007-08-12" who="#LB">Removed further elements added
since this ODD was first created </change>
      <change when="2007-04-09" who="#LB">Added prose and reorganized
structure to make it more document-like; changed deletion of attribute
decls into deletion of att.declaring class; add deletes for elements
email and floatingText added to P5 since this ODD was first created;
considered but did not implement removal of all irrelevant datatype specs...</change>
      <change when="2006-10-14" who="#sbauman.emt"> Made valid: <list><item>removed empty <att>prefix</att> attribute</item><item>added required <att>type</att> attribute to
          <gi>classSpec</gi>s</item></list><!--. <note>Sebastian had also made the above changes.</note> -->Also
        removed extraneous <gi>altIdent</gi> elements, improved
        <gi>sourceDesc</gi>, changed the <att>ident</att> of <gi>schemaSpec</gi>
        to match the filename, and added this revision description. </change>
    </revisionDesc>
  </teiHeader>
  <text>
    <front>
      <divGen type="toc"/>
    </front>
    <body>
      <p>This customization produces an extension usable in tagging Jewish liturgy for the Open Siddur Project.</p>
      <div><head>Introduction</head><!-- TODO: encode -->
On the most basic level, the siddur is simple text. As such, on first thought, a transcription of the material on a wiki, in a word processor document, or in a text file would seem sufficient for its representation. If that is the case, why define an XML encoding? And why does JLPTEI require the features it does? This introduction addresses the essential problems in representing the Jewish liturgy on a computer and how JLPTEI approaches the problems. It also gives the reasons behind some of the tradeoffs that were made in the design of JLPTEI.
JLPTEI is a technical means to achieving the Open Siddur Project's Mission Statement. As such, it must support "texts and supplemental material that may be accessed, shared, adapted, and improved on by the entire Jewish community," "a non-prescriptive attitude towards the manner in which individuals and communities engage tradition," "pluralism that reflects the multiplicity of creative expressions possible," and "awareness of historical, geographical, and philosophical diversity in Jewish communities." Respect for communal and individual diversity is at the core of the Open Siddur/Jewish Liturgy Project's mission, and guides the project's technological vision.
There is no such thing as a single text called The Siddur. On the broadest scale, siddur texts may be divided by rite (nusah). However, even accepting that there are multiple base texts, neither is there a single Ashkenazic siddur, Hasidic siddur, Sephardic siddur, etc. A rite is a major division which uniquely specifies a common denominator of customs within a group of customs. Within Ashkenaz, there are differences between the Polish and German customs. The Iraqi custom is not the same as the Yemenite custom, and the Lubavitch custom is not the same as the Breslov custom. There are also divisions within each rite along major the philosophical boundaries that have developed in recent centuries, which lead to differences in custom and text. The traditional-egalitarian rite (usually a variant of the Ashkenazic rite), for example, is still undergoing major evolution. As such, it is impossible to maintain a single source text. It is possible to maintain a bank of source texts, calling each one by the name of a given rite. The latter is the approach taken by many vendors, who will sell an electronic edition of a base-text siddur from a given rite. However, from a philosophical perspective, that approach fails to recognize diversity within Jewish communities, and essentially requires the project to canonize one text over another in the distributed version. Further, from a technical perspective, as more base texts are completed, the project becomes unscalable; with many copies of common texts in the archive, both correcting mistakes and remixing content in novel ways become increasingly difficult.
In addition, a modern siddur is expected to contain more than simple text. Aligned translations and transliterations and linked commentaries are usual fare. Some siddurim also contain art. As an online project, we also have the opportunity to link additional non-textual material, such as audio or video.
As a member of the community at large, it is also important to maintain a chain of credit and responsibility for our contributors, and a chain of bibliographic credit for ideas. This necessarily involves maintaining a great deal of metadata in addition to the texts and supplementary material.
The Open Siddur, therefore, takes a different approach, which is realized in the JLPTEI design. This approach involves (1) minimizing the amount of stored text, (2) storing the differences between the texts and (3) having user-selectable sets of conditions that specify when each variant is selected. If a typo is corrected in one variant, it is naturally corrected for all variants. Any stored metadata is also automatically consistent between all texts. An additional advantage of this approach is that a community with a custom that differs from the “base” custom of the rite only has to make a different choice of variants. No change is required in the text in order to support a slightly differing custom.
Aside from text versioning, a second major problem in representation is what should be represented. A user working on a word processor or desktop publishing system would first consider presentation. What is considered good presentation form is up to individual taste, and tastes are expected to change far more rapidly than the text. In a system intended for universal use, we must encode, along with the text, sufficient information to present the text. What we encode, however, should be intrinsic to the text, not to any aspect of its presentation. Separating the encoding of document structure from its presentation allows each user to make the presentation conform to his/her own tastes without duplicating effort on the encoding side.
The primary question then becomes: which structure should be encoded? Prose can be divided into paragraphs and sentences, poetic text can be divided into line groups and verse lines, lists into items and lists, etc. Many parts of the siddur have more than one structure on the same text! XML assumes that a document has a pure hierarchical tree structure. This suggests that XML is not an appropriate encoding technology for the siddur. At the same time, XML encoding is nearly universally standard and more software tools support XML-based formats than other encoding formats. One of the primary innovations of JLPTEI is its particular encoding of concurrent structural hierarchies. While the idea is not novel, the implementation is. The potential for the existence of concurrent structure is a guiding force in JLPTEI design.
The disadvantage of JLPTEI's encoding solutions is that the archival form of the text is not immediately consumable by humans. We are forced to rely extensively on processing software to make the format editable and displayable. The disadvantage, however, is balanced by the encoding format's extensibility and conservation of human labor.
The Open Siddur intends to work within open standards whenever possible. In choosing a basis for our encoding, we searched for available encoding standards that would suit our purposes. We seriously considered using Open Scripture Information Standard (OSIS), an XML format used for encoding bibles. It was quickly discovered that representations of some of the more advanced features required to encode the liturgy (such as those discussed above) would have to be "hacked" on top of the standard. The Text Encoding Initiative (TEI) XML format is a de-facto standard within the digital humanities community. It is also is specified in well-documented texts, is actively supported by tools, and has a large community built around its use and development. Further, the standard is deliberately extensible using a relatively simple mechanism. The TEI was therefore a natural choice as a basis for our encoding.
      </div>
      <div>
        <head>File structure</head>
        <!-- TODO: fill in, requirement for xml:lang => defines main text language for indexing -->
      </div>
      <div>
        <head>The header</head>
        <!-- TODO: fill in! -->
        <!-- responsibility -->
        <!-- sources -->
      </div>
      <div>
        <head>Basic text structure</head>
        <!-- TODO: fill in -->
      </div>
      <div>
        <head>The text stream</head>
        <!-- TODO: fill in -->
        <!-- main function of segments, also internal and external ptr -->
      </div>
      <div>
        <head>Concurrent text hierarchies</head>
        <!-- TODO: fill in -->
      </div>
      <div>
        <head>Translations and parallel texts</head>
        <!-- TODO: fill in -->
      </div>
      <div>
        <head>Instructions and annotations</head>
        <!-- TODO: fill in -->
      </div>
      <div>
        <head>Conditional texts</head>
        <!-- TODO: fill in -->
        <!-- time-defined texts -->
        <!-- declaring conditionals -->
        <!-- setting conditionals -->
        <!-- associating conditionals -->
      </div>
      <div>
        <head>Citations</head>
        <!-- TODO: fill in -->
      </div>
      <div>
        <head>Support files</head>
        <!-- TODO: fill in -->
        <div>
          <head>Transliteration</head>
          <!-- TODO: fill in -->
        </div>
        <p>Have their own schemas</p>
      </div>
      <div>
      </div>
      <div>
        <head>Formal declaration</head>
        <schemaSpec ident="jlptei" xml:lang="en" prefix="" ns="http://www.tei-c.org/ns/1.0">
          <moduleRef key="core" include="choice cit corr date divGen foreign head item l label lg list name note orig p ptr q quote ref reg sic title"/>
          <moduleRef key="tei"/>
          <moduleRef key="header" include="availability change distributor fileDesc licence publicationStmt revisionDesc sourceDesc teiHeader titleStmt"/>
          <moduleRef key="textstructure" include="TEI back body div docAuthor docDate docEdition docImprint docTitle front text titlePage titlePart"/>
          <moduleRef key="analysis" except="cl interp interpGrp m span spanGrp"/>
          <moduleRef key="certainty" except="certainty precision"/>
          <moduleRef key="gaiji" except="char charDecl charName charProp glyph glyphName localName mapping unicodeName value"/>
          <moduleRef key="iso-fs" except=""/>
          <moduleRef key="linking" except="alt altGrp join joinGrp timeline when"/>
          <moduleRef key="namesdates" except="addName affiliation age birth bloc climate country death district education event faith floruit geo geogFeat geogName langKnowledge langKnown listEvent listNym listOrg listPerson listPlace listRelation location nationality nym occupation offset org persName person personGrp place placeName population region relation relationGrp residence settlement sex socecStatus state terrain trait"/>
          <elementSpec ident="title" mode="change" module="core">
            <attList>
              <attDef ident="level" mode="delete"/>
            </attList>
          </elementSpec>
          <elementSpec ident="TEI" mode="change" module="textstructure">
            <attList>
              <attDef ident="version" mode="delete"/>
              <attDef ident="xml:lang" mode="change" usage="req">
                <desc>indicates the default language of the text in the document. Required because it determines how the document will be indexed in the database. &#13;
                </desc>
                <datatype minOccurs="1" maxOccurs="1">
                  <rng:text xmlns:rng="http://relaxng.org/ns/structure/1.0"/>
                </datatype>
              </attDef>
            </attList>
            <constraintSpec ident="TEI-j-1" scheme="isoschematron" mode="add">
              <constraint>
                <sch:ns prefix="j" uri="http://jewishliturgy.org/ns/jlptei/1.0"/>
              </constraint>  
            </constraintSpec>
          </elementSpec>
          <elementSpec ident="ptr" mode="change" module="core">
            <!-- TODO: need an additional constraint where we test if all pointer targets exist -->
            <constraintSpec scheme="isoschematron" ident="ptr-j-1">
              <desc>Test that internal #range pointers point to a reasonable range</desc>
              <constraint>
                <sch:assert
                  test="
                  not(contains(@target, '#range')) or (
                  for 
                    $token in tokenize(@target, '\s+')[starts-with(., '#range')],
                    $lptr in substring-after(substring-before($token, ','), '('),
                    $rptr in substring-before(substring-after($token, ','), ')')
                  return 
                    exists(//id($lptr)) and
                    exists(//id($rptr)) and
                    //id($lptr) &lt;&lt; //id($rptr)
                  )
                    ">
                  In a #range(lptr,rptr) XPath expression, the left pointer must precede the right pointer.  
                </sch:assert>
              </constraint>
            </constraintSpec>
          </elementSpec>
          <elementSpec ident="sourceDesc" mode="change" module="header">
            <attList>
              <attDef ident="default" mode="delete"/>
            </attList>
            <content>
              <rng:oneOrMore xmlns:rng="http://relaxng.org/ns/structure/1.0">
                <rng:ref name="model.sourceDescPart"/>
              </rng:oneOrMore>
            </content>
          </elementSpec>
          <classSpec ident="att.global" mode="change" module="tei" type="atts">
            <attList>
              <attDef ident="xml:space" mode="delete"/>
              <attDef ident="rend" mode="delete"/>
              <attDef ident="rendition" mode="delete"/>
            </attList>
          </classSpec>
          <classSpec ident="att.divLike" mode="change" module="tei" type="atts">
            <attList>
              <attDef ident="org" mode="delete"/>
              <attDef ident="sample" mode="delete"/>
            </attList>
          </classSpec>
          <classSpec ident="att.canonical" mode="delete" module="tei" type="atts"/>
          <classSpec ident="att.declaring" mode="delete" module="tei" type="atts"/>
          <classSpec ident="att.datcat" mode="delete" module="tei" type="atts"/>
          <elementSpec ident="responsGrp" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>Group elements that declare responsibility over a portion of text.</desc>
            <classes>
              <memberOf key="model.respLike"/>
              <memberOf key="att.global"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:oneOrMore>
                <rng:ref name="respons"/>
              </rng:oneOrMore>
            </content>
          </elementSpec>
          <classSpec ident="att.responsibility" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.damaged" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.breaking" module="tei" mode="delete" type="atts"/>
          <elementSpec ident="conditions" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>Holds features and feature structures pertaining to the conditional system.</desc>
            <classes>
              <memberOf key="model.resourceLike"/>
              <memberOf key="att.global"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:oneOrMore>
                <rng:choice>
                  <rng:ref name="fs"/>
                  <rng:ref name="f"/>
                  <rng:ref name="fvLib"/>
                </rng:choice>
              </rng:oneOrMore>
            </content>
          </elementSpec>
          <classSpec ident="att.transcriptional" module="tei" mode="delete" type="atts"/>
          <elementSpec ident="links" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>Holds standoff markup links </desc>
            <classes>
              <memberOf key="model.resourceLike"/>
              <memberOf key="att.global"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:oneOrMore>
                <rng:choice>
                  <rng:ref name="link"/>
                  <rng:ref name="linkGrp"/>
                </rng:choice>
              </rng:oneOrMore>
            </content>
          </elementSpec>
          <elementSpec ident="annotations" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>A resource that holds annotations, such as notes or standoff annotations.</desc>
            <classes>
              <memberOf key="model.resourceLike"/>
              <memberOf key="att.global"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:oneOrMore>
                <rng:choice>
                  <rng:ref name="note"/>
                  <rng:ref name="fs"/>
                </rng:choice>
              </rng:oneOrMore>
            </content>
          </elementSpec>
          <elementSpec ident="segGen" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>Generated segment.</desc>
            <attList>
              <attDef ident="type" mode="change" usage="req">
                <desc>Type of segment generation that is required.</desc>
                <datatype minOccurs="1" maxOccurs="1">
                  <rng:ref xmlns:rng="http://relaxng.org/ns/structure/1.0" name="data.enumerated"/>
                </datatype>
                <valList type="closed">
                  <valItem ident="transliteration"/>
                </valList>
              </attDef>
            </attList>
            <classes>
              <memberOf key="model.segLike"/>
              <memberOf key="att.global"/>
            </classes>
            <content>
              <rng:ref xmlns:rng="http://relaxng.org/ns/structure/1.0" name="macro.paraContent"/>
            </content>
          </elementSpec>
          <classSpec ident="att.datable.custom" module="namesdates" mode="delete" type="atts"/>
          <classSpec ident="att.datable.iso" module="namesdates" mode="delete" type="atts"/>
          <classSpec ident="att.datable" module="tei" mode="change" type="atts">
            <attList>
              <attDef ident="calendar" mode="delete"/>
              <attDef ident="period" mode="delete"/>
            </attList>
          </classSpec>
          <classSpec ident="att.datable.w3c" module="tei" mode="change" type="atts">
            <attList>
              <attDef ident="notBefore" mode="delete"/>
              <attDef ident="notAfter" mode="delete"/>
              <attDef ident="from" mode="delete"/>
              <attDef ident="to" mode="delete"/>
            </attList>
          </classSpec>
          <classSpec ident="att.declarable" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.dimensions" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.duration.iso" module="namesdates" mode="delete" type="atts"/>
          <classSpec ident="att.duration.w3c" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.editLike" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.enjamb" module="verse" mode="delete" type="atts"/>
          <elementSpec ident="read" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>Indicates the portion of a text that is read in read-written (kri-ktiv) choice.</desc>
            <classes>
              <memberOf key="model.choicePart"/>
              <memberOf key="att.global"/>
            </classes>
            <content>
              <rng:ref xmlns:rng="http://relaxng.org/ns/structure/1.0" name="macro.specialPara"/>
            </content>
          </elementSpec>
          <elementSpec ident="written" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>Indicates the part of a text that is written </desc>
            <classes>
              <memberOf key="model.choicePart"/>
              <memberOf key="att.global"/>
            </classes>
            <content>
              <rng:ref xmlns:rng="http://relaxng.org/ns/structure/1.0" name="macro.paraContent"/>
            </content>
          </elementSpec>
          <elementSpec ident="option" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>Marks a section of text, which may be included, depending on the result of a conditional evaluation.</desc>
            <classes>
              <memberOf key="model.choicePart"/>
              <memberOf key="att.global"/>
            </classes>
            <content>
              <rng:ref xmlns:rng="http://relaxng.org/ns/structure/1.0" name="macro.paraContent"/>
            </content>
          </elementSpec>
          <elementSpec ident="respons" module="certainty" mode="change">
            <attList>
              <attDef ident="type" mode="add" usage="req">
                <desc>Responsibility type, indicated using one of the allowed MARC relator codes, as defined at http://www.loc.gov/marc/relators/relacode.html&#13;
aut (author), edt (editor), fac (facsimilist, scanner?), fnd (funder), pfr (proofreader), spn, (sponsor), trl (translator), trc (transcriber)</desc>
                <datatype minOccurs="1" maxOccurs="1">
                  <rng:ref xmlns:rng="http://relaxng.org/ns/structure/1.0" name="data.enumerated"/>
                </datatype>
                <valList type="closed">
                  <valItem ident="aut"/>
                  <valItem ident="edt"/>
                  <valItem ident="fac"/>
                  <valItem ident="fnd"/>
                  <valItem ident="pfr"/>
                  <valItem ident="spn"/>
                  <valItem ident="trl"/>
                  <valItem ident="trc"/>
                </valList>
              </attDef>
            </attList>
            <classes mode="replace">
              <memberOf key="model.certLike"/>
              <memberOf key="att.global"/>
              <memberOf key="att.scoping"/>
              <memberOf key="model.global" mode="delete"/>
              <memberOf key="model.global.meta" mode="delete"/>
            </classes>
          </elementSpec>
          <elementSpec ident="divineName" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>Contains a proper name for the Deity. </desc>
            <classes>
              <memberOf key="model.nameLike"/>
              <memberOf key="att.global"/>
              <memberOf key="att.typed"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:choice>
                <rng:ref name="macro.phraseSeq"/>
                <rng:group>
                  <rng:ref name="reg"/>
                  <rng:ref name="orig"/>
                </rng:group>
                <rng:group>
                  <rng:ref name="orig"/>
                  <rng:ref name="reg"/>
                </rng:group>
              </rng:choice>
            </content>
          </elementSpec>
          <elementSpec ident="w" module="analysis" mode="change">
            <content xmlns:default="http://relaxng.org/ns/structure/1.0">
              <default:zeroOrMore xmlns="http://relaxng.org/ns/structure/1.0">
                <default:choice>
                  <default:text/>
                  <default:ref name="model.gLike"/>
                  <default:ref name="seg"/>
                  <default:ref name="w"/>
                  <default:ref name="m"/>
                  <default:ref name="c"/>
                  <default:ref name="model.global"/>
                  <default:ref name="model.lPart"/>
                  <default:ref name="model.hiLike"/>
                  <default:ref name="model.pPart.edit"/>
                  <default:ref name="divineName"/>
                </default:choice>
              </default:zeroOrMore>
            </content>
          </elementSpec>
          <elementSpec ident="parallelGrp" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>A special type of <gi>linkGrp</gi> that groups units of parallel text by language. The <gi>ptr</gi> 
            elements must have <att>xml:lang</att> attributes</desc>
            <classes>
              <memberOf key="att.global"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:ref name="ptr"/>
              <rng:oneOrMore>
                <rng:ref name="ptr"/>
              </rng:oneOrMore>
            </content>
            <constraintSpec ident="parallelGrp-1" scheme="isoschematron">
              <constraint>
                <sch:report test="tei:ptr[not(@xml:lang)]">Every tei:ptr inside a parallelGrp requires @xml:lang.</sch:report>
              </constraint>
            </constraintSpec>
          </elementSpec>
          <elementSpec ident="parallelText" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>The main body element for a text that consists of a parallelization of multiple texts.  </desc>
            <attList>
              <attDef ident="level" mode="add" usage="req">
                <desc>The segmentation level at which the parallelization is done, for example, segment, verse, paragraph, line-group, line, etc. Use one of the recommended values unless none of them makes sense.</desc>
                <datatype minOccurs="1" maxOccurs="1">
                  <rng:ref xmlns:rng="http://relaxng.org/ns/structure/1.0" name="data.enumerated"/>
                </datatype>
                <defaultVal>other</defaultVal>
                <valList type="open">
                  <valItem ident="seg"/>
                  <valItem ident="verse"/>
                  <valItem ident="chapter"/>
                  <valItem ident="p"/>
                  <valItem ident="lg"/>
                  <valItem ident="l"/>
                  <valItem ident="div"/>
                </valList>
              </attDef>
            </attList>
            <classes>
              <memberOf key="att.global"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:oneOrMore>
                <rng:ref name="parallelGrp"/>
              </rng:oneOrMore>
            </content>
          </elementSpec>
          <elementSpec ident="text" module="textstructure" mode="change">
            <content xmlns="http://relaxng.org/ns/structure/1.0">
              <optional>
                <ref name="front"/>
              </optional>
              <choice>
                <ref name="parallelText"/>
                <group>
                  <ref name="textStream"/>
                  <optional>
                    <oneOrMore>
                      <ref name="concurrent"/>
                    </oneOrMore>
                  </optional>
                </group>
              </choice>
              <optional>
                <ref name="back"/>
              </optional>
            </content>
            <classes mode="replace">
              <memberOf key="att.global"/>
              <memberOf key="att.typed"/>
              <memberOf key="att.declaring" mode="delete"/>
            </classes>
            <content>
              <rng:group xmlns:rng="http://relaxng.org/ns/structure/1.0">
                <rng:optional>
                  <rng:ref name="front"/>
                </rng:optional>
                <rng:choice>
                  <rng:ref name="body"/>
                  <rng:ref name="parallelText"/>
                  <rng:group>
                    <rng:ref name="streamText"/>
                    <rng:zeroOrMore>
                      <rng:ref name="concurrent"/>
                    </rng:zeroOrMore>
                  </rng:group>
                </rng:choice>
                <rng:optional>
                  <rng:ref name="back"/>
                </rng:optional>
              </rng:group>
            </content>
          </elementSpec>
          <elementSpec ident="layer" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>A hierarchic layer of text. @type should indicate what layer is being provided, and all the top level contained elements should be consistent with that type.</desc>
            <classes>
              <memberOf key="att.global"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:group xmlns="http://relaxng.org/ns/structure/1.0">
                <rng:zeroOrMore>
                  <rng:choice>
                    <rng:ref name="model.divTop"/>
                    <!--        <rng:ref name="model.headLike"/>-->
                    <rng:ref name="model.global"/>
                  </rng:choice>
                </rng:zeroOrMore>
                <rng:optional>
                  <rng:choice>
                    <rng:group>
                      <rng:oneOrMore>
                        <rng:choice>
                          <rng:ref name="model.divLike"/>
                          <rng:ref name="model.divGenLike"/>
                        </rng:choice>
                        <rng:zeroOrMore>
                          <rng:ref name="model.global"/>
                        </rng:zeroOrMore>
                      </rng:oneOrMore>
                    </rng:group>
                    <rng:group>
                      <rng:oneOrMore>
                        <rng:group>
                          <rng:ref name="model.common"/>
                        </rng:group>
                        <rng:zeroOrMore>
                          <rng:ref name="model.global"/>
                        </rng:zeroOrMore>
                      </rng:oneOrMore>
                      <rng:zeroOrMore>
                        <rng:choice>
                          <rng:ref name="model.divLike"/>
                          <rng:ref name="model.divGenLike"/>
                        </rng:choice>
                        <rng:zeroOrMore>
                          <rng:ref name="model.global"/>
                        </rng:zeroOrMore>
                      </rng:zeroOrMore>
                    </rng:group>
                  </rng:choice>
                  <rng:zeroOrMore>
                    <rng:group>
                      <rng:ref name="model.divBottom"/>
                    </rng:group>
                    <rng:zeroOrMore>
                      <rng:ref name="model.global"/>
                    </rng:zeroOrMore>
                  </rng:zeroOrMore>
                </rng:optional>
              </rng:group>
            </content>
            <attList>
              <attDef ident="type" mode="add" usage="req">
                <desc>Indicates what type of hierarchic layer is being constructed</desc>
                <datatype minOccurs="1" maxOccurs="1">
                  <rng:ref xmlns:rng="http://relaxng.org/ns/structure/1.0" name="data.enumerated"/>
                </datatype>
                <valList type="open">
                  <valItem ident="p"/>
                  <valItem ident="s"/>
                  <valItem ident="l"/>
                  <valItem ident="lg"/>
                  <valItem ident="cit"/>
                  <valItem ident="choice"/>
                  <valItem ident="verse"/>
                </valList>
              </attDef>
            </attList>
            <constraintSpec ident="layer-1" scheme="isoschematron">
              <constraint>
                <sch:report 
                  test="descendant::tei:ptr[substring-before(@target, '#') != '']">
                  Only internal pointers are allowed inside concurrent structures
                </sch:report>
                <sch:assert
                  test="
                  for 
                    $ptr in descendant::tei:ptr,
                    $token in tokenize(@target,'\s+'),
                    $id in (
                      if (starts-with($token, '#range'))
                      then
                        tokenize(
                          substring-before(
                            substring-after(
                              $token,
                              '#range('
                            ),
                            ')'
                          ),
                          ','
                        )[.]
                      else substring-after($token, '#')
                    )
                  return //id($id)/ancestor::j:streamText">
                  All pointers in layers must point into the text stream.  
                </sch:assert>
              </constraint>
            </constraintSpec>
          </elementSpec>
          <elementSpec ident="concurrent" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>A list of concurrent hierarchies of one or more layers.</desc>
            <classes>
              <memberOf key="att.global"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:oneOrMore>
                <rng:ref name="layer"/>
              </rng:oneOrMore>
            </content>
          </elementSpec>
          <elementSpec ident="streamText" ns="http://jewishliturgy.org/ns/jlptei/1.0" mode="add">
            <desc>A continuous stream of segmented text, suitable for concurrent hierarchies. Every element contained in a textStream must be able to be referenced by @xml:id or using a range XPointer.</desc>
            <classes>
              <memberOf key="att.global"/>
            </classes>
            <content xmlns:rng="http://relaxng.org/ns/structure/1.0">
              <rng:group xmlns="http://relaxng.org/ns/structure/1.0">
                <rng:oneOrMore>
                  <rng:choice>
                    <rng:ref name="model.segLike"/>
                    <rng:ref name="model.milestoneLike"/>
                    <rng:ref name="ptr"/>
                  </rng:choice>
                </rng:oneOrMore>
              </rng:group>
            </content>
            <constraintSpec ident="streamText-1" scheme="isoschematron">
              <constraint>
                <sch:report test="*[not(@xml:id)]">An @xml:id attribute is required on all elements in a text stream.</sch:report>
              </constraint>
            </constraintSpec>
          </elementSpec>
          <classSpec ident="att.msExcerpt" module="msdescription" mode="delete" type="atts"/>
          <classSpec ident="att.global.change" module="transcr" mode="delete" type="atts"/>
          <!-- keeping @next, @prev -->
          <classSpec ident="att.global.linking" module="linking" mode="change" type="atts">
            <attList>
              <attDef ident="corresp" mode="delete"/>
              <attDef ident="synch" mode="delete"/>
              <attDef ident="sameAs" mode="delete"/>
              <attDef ident="copyOf" mode="delete"/>
              <attDef ident="exclude" mode="delete"/>
              <attDef ident="select" mode="delete"/>
            </attList>
          </classSpec>
          <classSpec ident="att.translatable" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.timed" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.textCritical" module="textcrit" mode="delete" type="atts"/>
          <classSpec ident="att.tableDecoration" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.spanning" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.sourced" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.sortable" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.segLike" module="tei" mode="change" type="atts">
            <attList>
              <attDef ident="function" mode="delete"/>
            </attList>
          </classSpec>
          <classSpec ident="att.interpLike" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.measurement" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.readFrom" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.rdgPart" module="textcrit" mode="delete" type="atts"/>
          <classSpec ident="att.ranging" module="tei" mode="delete" type="atts"/>
          <elementSpec ident="teiHeader" module="header" mode="change">
            <attList>
              <attDef ident="type" mode="delete"/>
              <attDef ident="n" mode="delete"/>
              <attDef ident="rend" mode="delete"/>
              <attDef ident="rendition" mode="delete"/>
              <attDef ident="xml:space" mode="delete"/>
            </attList>
          </elementSpec>
          <classSpec ident="att.naming" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.placement" module="tei" mode="delete" type="atts"/>
          <classSpec ident="att.global.analytic" module="analysis" mode="delete" type="atts"/>
          <elementSpec ident="ab" module="linking" mode="change">
            <classes mode="replace">
              <memberOf key="model.pLike"/>
              <memberOf key="att.global"/>
              <memberOf key="att.typed"/>
              <memberOf key="att.declaring" mode="delete"/>
            </classes>
            <attList>
              <attDef ident="part" mode="delete"/>
            </attList>
          </elementSpec>
          <elementSpec ident="p" module="core" mode="change">
            <classes mode="replace">
              <memberOf key="model.pLike"/>
              <memberOf key="att.declaring"/>
              <memberOf key="att.global"/>
              <memberOf key="model.availabilityPart" mode="delete"/>
            </classes>
          </elementSpec>
          <elementSpec ident="link" module="linking" mode="change">
            <attList>
              <attDef ident="targets" mode="delete"/>
            </attList>
            <classes mode="replace">
              <memberOf key="model.global"/>
              <memberOf key="model.global.meta"/>
              <memberOf key="model.sourceDescPart" mode="add"/>
              <memberOf key="att.global"/>
              <memberOf key="att.pointing"/>
              <memberOf key="att.typed"/>
            </classes>
          </elementSpec>
          <elementSpec ident="linkGrp" module="linking" mode="change">
            <classes mode="replace">
              <memberOf key="model.global"/>
              <memberOf key="model.global.meta"/>
              <memberOf key="model.sourceDescPart" mode="add"/>
              <memberOf key="att.global"/>
              <!--memberOf key="att.pointing"/-->
              <memberOf key="att.pointing.group"/>
            </classes>
          </elementSpec>
          <moduleRef key="transcr" except="addSpan am damage damageSpan delSpan ex facsimile fw handNotes handShift line listTranspose metamark mod redo restore retrace space subst substJoin supplied surface surfaceGrp surplus transpose undo zone"/>
          <classSpec ident="att.global.facs" module="transcr" mode="delete" type="atts"/>
          <classSpec ident="att.pointing.group" module="tei" mode="change" type="atts">
            <attList>
              <attDef ident="domains" mode="delete"/>
              <attDef ident="targFunc" mode="delete"/>
            </attList>
          </classSpec>
        </schemaSpec>
      </div>
    </body>
  </text>
</TEI>
